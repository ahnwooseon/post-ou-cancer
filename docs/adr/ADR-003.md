# ADR-003: Adopting .NET Aspire for Orchestration and Observability

## 1. Context

The **Modular Monolith** architecture ([ADR-002](./ADR-002.md)) depends on several backing services: PostgreSQL, Redis, RabbitMQ, Keycloak, and a Python/FastAPI AI worker. Managing the lifecycle, configuration, networking, and diagnostics for this distributed, polyglot system manually is complex and directly contradicts the goal of maximizing **developer velocity**. We require a unified tool to orchestrate this complexity seamlessly.

## 2. Decision

We will adopt **.NET Aspire** as the primary framework for orchestrating all application resources, managing service discovery, and providing a unified observability stack. The `Aspire.AppHost` project will serve as the single entry point for launching and managing the entire local development environment, including all .NET and non-.NET services.

## 3. Status

Accepted.

## 4. Consequences

### Positive ✅

* **Drastically Simplified Local Development**: A single command (`dotnet run` on the `AppHost`) launches and configures the entire stack (databases, message queues, polyglot services). This eliminates manual setup scripts and reduces developer onboarding friction to near zero.
* **Built-in Service Discovery**: Aspire automatically manages service addresses and injects connection strings into dependent applications at runtime. This completely removes the need for hardcoded URLs or complex environment variable management in local development.
* **Unified, Zero-Configuration Observability**: Aspire provides an out-of-the-box dashboard for viewing structured logs, distributed traces, and key performance metrics from **all** orchestrated services (including the Python worker). This is a critical force multiplier for debugging distributed workflows as a solo developer.
* **Seamless Polyglot Orchestration**: Aspire natively orchestrates containerized non-.NET services (like the Python AI worker) alongside .NET projects, providing a single, cohesive view of the entire application stack.
* **Clear Path to Production**: The Aspire manifest provides a standardized definition of the application's architecture, which simplifies the process of generating deployment artifacts (e.g., Helm charts, Docker Compose files) for production environments (as planned in PI-4).

### Negative ❌

* **Opinionated Framework**: Aspire introduces a specific set of conventions and abstractions. This requires an initial time investment to learn, but the productivity gains are expected to far outweigh this cost.
* **Dependency on Containerization**: To achieve full polyglot orchestration and observability, non-.NET services must be containerized and configured to emit OpenTelemetry data, adding a minor setup requirement for those components.

## 5. Alternatives Considered

| Alternative                                  | Rationale for Rejection                                                                                                                                                                                        |
| :------------------------------------------- | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **Manual Docker Compose + Custom Scripting** | Brittle and high-maintenance. Lacks integrated service discovery and requires a separate, manually configured observability stack (e.g., Prometheus, Grafana, Jaeger), which increases complexity and slows down debugging. |
| **Local Kubernetes (k3s/Minikube)**          | Excessive operational overhead for local development. The complexity of managing Kubernetes manifests, networking, and storage for a development loop would severely hinder developer velocity. This is reserved for the production environment (PI-4). |
| **Tye**                                      | Superseded by .NET Aspire. Aspire is the official, more powerful, and fully supported evolution of the concepts pioneered in Tye, making it the clear choice for a new project.                                |

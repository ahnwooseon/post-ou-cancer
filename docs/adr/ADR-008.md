# ADR-008: Deployment Strategy

## 1. Context

The project requires a clear, phased deployment strategy that supports rapid local development initially and scales to a robust, highly available production environment. The strategy must align with the architectural choices of a Modular Monolith orchestrated by .NET Aspire and accommodate its various backing services (PostgreSQL, Redis, etc.).

## 2. Decision

We will adopt a three-phased deployment strategy:

1.  **Local Development (Phase 1):** The entire application stack will be orchestrated by **.NET Aspire** using Docker containers, managed via a single `docker-compose.yml` file. This provides a consistent, one-command startup experience for developers.
2.  **Staging/Initial Production (Phase 2):** The application will be deployed to a lightweight Kubernetes distribution like **k3s**. Deployment will be managed via **Helm charts**, which can be generated from the .NET Aspire manifest, providing a clear path from development to a production-like environment.
3.  **Full Production (Phase 3):** The application will be deployed on a managed Kubernetes service (e.g., AKS, EKS, GKE) for full scalability, reliability, and security. Deployments will be managed using a **GitOps** workflow with tools like **ArgoCD** or **Flux**.

## 3. Status

Accepted.

## 4. Consequences

### Positive ✅

*   **Smooth Progression**: This strategy provides a natural evolution from a simple local setup to a complex, cloud-native production environment. Each phase builds upon the previous one, minimizing friction.
*   **Consistency**: Using containers (Docker) from day one ensures that the application runs in a consistent environment from local development through to production, eliminating "it works on my machine" issues.
*   **Automation and GitOps**: Adopting Helm and GitOps for production enables declarative, version-controlled, and automated deployments, which is critical for reliability and disaster recovery.
*   **Leverages Aspire**: The strategy makes full use of .NET Aspire's capabilities, using it for local orchestration and then using its manifest output to bootstrap the Kubernetes deployment artifacts.

### Negative ❌

*   **Kubernetes Complexity**: Kubernetes is a powerful but complex system. There is a significant learning curve and operational overhead associated with managing a production-grade cluster. **Mitigation**: This complexity is deferred until the later stages of the project (PI-4), and using a managed Kubernetes service will offload much of the underlying infrastructure management.

## 5. Alternatives Considered

| Alternative                      | Rationale for Rejection                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           -
| **Platform as a Service (PaaS)** | Services like Heroku or Fly.io offer a much simpler deployment experience than Kubernetes. However, they provide less control over the underlying infrastructure (e.g., networking, storage) and can become more expensive at scale. Kubernetes provides the ultimate flexibility and portability required for the project's long-term vision. |
| **Virtual Machines (VMs)**       | The traditional approach of deploying to VMs is well-understood but lacks the orchestration, scalability, and resilience features provided by Kubernetes. Managing dependencies and ensuring consistent environments across VMs is significantly more difficult than with a container-based workflow. |
